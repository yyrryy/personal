{% extends 'base.html' %}

{% block content %}
<div class="row"> 
    <!-- Left Panel
    ============================================= -->
    <aside class="col-lg-3"> 
       
      
      <!-- Available Balance
      =============================== -->
      <div class="bg-white shadow-sm rounded text-center p-3 mb-4">
        <div class="text-17 text-light my-3"><i class="fas fa-wallet"></i></div>
        <!-- <h3 class="text-9 fw-400">{{profile.balance}}</h3> -->
        <h3 class="text-9 fw-400">--</h3>
        <p class="mb-2 text-muted opacity-8">Available Balance</p>
        <hr class="mx-n3">  
        <div class="d-flex">
          <a onclick="$('.addbalance').toggleClass('d-none')" class="btn btn-link me-auto">ADD</a> 
          <a onclick="$('.outbalance').toggleClass('d-none')" class="btn btn-link ms-auto">OUT</a></div>
      </div>

      <div class="bg-white mt-5 rounded border">
        <input type="number" class="km" oninput="calcessence()" placeholder="KM">
        <input type="number" class="essenceprice" oninput="calcessence()" placeholder="essenceprice">
        <strong class="essenceqty"></strong> L ess
        <strong class="essencedh"></strong> Dhs
      </div>

      <div class="bg-white mt-5 rounded border">
        total: <strong>{{essenceout}}</strong>
        per day: <strong>{{essenceoutperday}}</strong>
        provision: <strong>{{thismonthessence}}</strong>
        nextfill: <strong>{{nextfill}}</strong>
      </div>

      <a class="btn btn-primary w-100" href="/activities">
        Activities
      </a>
      <!-- Available Balance End --> 

      <!-- out balance form -->
      <div class="shadow-sm rounded p-3 pt-sm-5 pb-sm-5 px-sm-5 mb-4 outbalance d-none" style="background: rgba(251, 121, 121, 0.368)
      ;"> 
        
        <form id="form-send-money" class="outform" method="post" action="/outbalance">
            {%csrf_token%}
          <div class="mb-3">
            <label for="youSend">Amount</label>
            <input type="text" class="form-control" name="amountout" placeholder="" required>
          </div>
          <div class="mb-3">
            <label for="paymentMethod" class="form-label">Payment Method</label>
            <select name="raisonout" class="form-select raisonout" required="" onchange="makerequire()">
              <option value="">Select Payment Method</option>
              {% for i in outraisons %}
              <option value="{{i.id}}">
                {{i}}
              </option>
              {% endfor %}
            </select>
            <input type="text" name="essaanceprice" class="form-control" placeholder="essaanceprice" >
            <input type="text" name="kilomtrage" class="form-control" placeholder="kilomtrage" >
            <select name="empty" id="" class="form-control">
              <option value="">empty tank</option>
              <option value="yes">yes</option>
              <option value="no">no</option>
            </select>
          </div>
          
          <div class="d-grid"><button class="btn btn-primary">Continue</button></div>
        </form>
        <!-- Deposit Money Form end --> 
      </div>

      <!-- add to balance -->
      <div class="shadow-sm rounded p-3 pt-sm-5 pb-sm-5 px-sm-5 mb-4 addbalance d-none" style="background: rgba(121, 251, 151, 0.368)
      ;"> 
        
        <form id="form-send-money" method="post" action="/addtobalance">
            {%csrf_token%}
          <div class="mb-3">
            <label for="youSend">Amount</label>
            <input type="text" class="form-control" name="amountin" placeholder="" required>
          </div>
          <div class="mb-3">
            <label for="paymentMethod" class="form-label">Payment Method</label>
            <select name="raisonin" class="form-select" required="">
              <option value="">Select Payment Method</option>
              {% for i in inraisons %}
              <option value="{{i.id}}">
                {{i}}
              </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="d-grid"><button class="btn btn-primary">Continue</button></div>
        </form>
        <!-- Deposit Money Form end --> 
      </div>
      
      
      
    </aside>
    <!-- Left Panel End -->
    
    <!-- Middle Panel
    ============================================= -->
    <div class="col-lg-9"> 
      
      <!-- Profile Completeness
      =============================== -->
      <div class="bg-white shadow-sm rounded p-4 mb-4">
        <div class="progress">
          <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: {{ageindays}}%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <!-- <h3 class="text-5 fw-400 d-flex align-items-center mb-4">{{profile.name}}<span class="border text-success rounded-pill fw-500 text-2 px-3 py-1 ms-2">{{profile.age}} yo</span></h3>
        <hr class="mb-4 mx-n4"> -->
        <h3 class="text-5 fw-400 d-flex align-items-center mb-4">{{profile.name}}<span class="border text-success rounded-pill fw-500 text-2 px-3 py-1 ms-2">-- yo</span></h3>
        <hr class="mb-4 mx-n4">
        <div class="d-flex justify-content-between">
          
          <div>
            in of this mount - outsmonth=net <br>
            {{fromlastmonth}} + {{thismonthin}} - {{thismonthout}} =<strong class="actualsold">{{netmonthbalance}}</strong>
          </div>
          <div>
            <input type="text" class="realsold">
            <button class="btn btn-primary" onclick="adjustsold(event)"></button>
          </div>
        </div>
      </div>
      <!-- Profile Completeness End --> 
      
      <!-- Recent Activity
      =============================== -->
      <div class="bg-white shadow-sm rounded py-4 mb-4 p-2">
        <div class="mb-3 d-flex justify-content-between">
          <div class="col-3">
            <select name="" class="form-select" onchange="getsource(event)">
              <option value="">Source</option>
              {% for i in inraisons %}
              <option value="{{i.id}}">
                {{i}}
              </option>
              {% endfor %}
            </select>
          </div>
          <div>
            <strong class="text-4">Total:</strong>
            <strong class="text-4 totalfromsource">0.00</strong>
          </div>
          <div>
            <strong class="text-4">Rest:</strong>
            <strong class="text-4 restfromsource">0.00</strong>
          </div>
        </div>
        <hr>
        
        <!-- Title
        =============================== -->
        <div class="transaction-title py-2 px-4">
          <div class="row fw-00">
            <div class="col-2 col-sm-1 text-center"><span class="">Date</span></div>
            <div class="col col-sm-7">Description</div>
            <div class="col-auto col-sm-2 d-none d-sm-block text-center">Status</div>
            <div class="col-3 col-sm-2 text-end">Amount</div>
          </div>
        </div>
        <!-- Title End --> 
        
        <!-- Transaction List
        =============================== -->
        <div class="transaction-list">
          {% for i in releve %}
          <div class="transaction-item px-4 py-3" data-bs-toggle="modal" data-bs-target="#transaction-detail" style="background:{%if i.1 == 'outbb'%}#f9d2d2{%else%}rgba(172, 255, 47, 0.304){%endif%};">
          <div class="row align-items-center flex-row">
              <div class="col-2 col-sm-1 text-center">
              {{i.0.date|date:'d/m/Y H:i'}} 
              </div>
              <div class="col col-sm-7"> <span class="d-block text-4">{{i.0.raison}} ({{i.0.note}})</span> </div>
              <div class="col-auto col-sm-2 d-none d-sm-block text-center text-3"> <span class="text-warning" data-bs-toggle="tooltip" title="" data-bs-original-title="In Progress" aria-label="In Progress"><i class="fas fa-ellipsis-h"></i></span> </div>
              <div class="col-3 col-sm-2 text-end text-4"> <span class="text-nowrap">{{i.0.amount}}</span></div>
          </div>
          </div>
          {% endfor %}
          
        </div>
        <!-- Transaction List End --> 
        
        <!-- Transaction Item Details Modal
        =========================================== -->
        <div id="transaction-detail" class="modal fade" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered transaction-details" role="document">
            <div class="modal-content">
              <div class="modal-body">
                <div class="row g-0">
                  <div class="col-sm-5 d-flex justify-content-center bg-primary rounded-start py-4">
                    <div class="my-auto text-center">
                      <div class="text-17 text-white my-3"><i class="fas fa-building"></i></div>
                      <h3 class="text-4 text-white fw-400 my-3">Envato Pty Ltd</h3>
                      <div class="text-8 fw-500 text-white my-4">$557.20</div>
                      <p class="text-white">15 March 2021</p>
                    </div>
                  </div>
                  <div class="col-sm-7">
                    <h5 class="text-5 fw-400 m-3">Transaction Details
                      <button type="button" class="btn-close text-2 float-end" data-bs-dismiss="modal" aria-label="Close"></button>
                    </h5>
                    <hr>
                    <div class="px-3">
                      <ul class="list-unstyled">
                        <li class="mb-2">Payment Amount <span class="float-end text-3">$562.00</span></li>
                        <li class="mb-2">Fee <span class="float-end text-3">-$4.80</span></li>
                      </ul>
                      <hr class="mb-2">
                      <p class="d-flex align-items-center fw-500 mb-0">Total Amount <span class="text-3 ms-auto">$557.20</span></p>
                      <hr class="mb-4 mt-2">
                      <ul class="list-unstyled">
                        <li class="fw-500">Paid By:</li>
                        <li class="text-muted">Envato Pty Ltd</li>
                      </ul>
                      <ul class="list-unstyled">
                        <li class="fw-500">Transaction ID:</li>
                        <li class="text-muted">26566689645685976589</li>
                      </ul>
                      <ul class="list-unstyled">
                        <li class="fw-500">Description:</li>
                        <li class="text-muted">Envato March 2021 Member Payment</li>
                      </ul>
                      <ul class="list-unstyled">
                        <li class="fw-500">Status:</li>
                        <li class="text-muted">Completed<span class="text-success text-3 ms-1"><i class="fas fa-check-circle"></i></span></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Transaction Item Details Modal End --> 
        
        <!-- View all Link
        =============================== -->
        <div class="text-center mt-4"><a href="transactions.html" class="btn-link text-3">View all<i class="fas fa-chevron-right text-2 ms-2"></i></a></div>
        <!-- View all Link End --> 
        
      </div>
      <!-- Recent Activity End --> 
    </div>
    <!-- Middle Panel End --> 
  </div>
{% endblock %}
{% block js %}
<script>
  function calcessence(){
    km=$('.km').val()
    // 190km --> 3.75L
    // 10km --> xL
    essenceprice=$('.essenceprice').val()
    essence=(3.75*parseFloat(km))/190
    essencedh=essence*essenceprice
    $('.essenceqty').text(essence)
    $('.essencedh').text(essencedh)
  }
  function makerequire(){
    raison=$('.raisonout').val()
    if (raison=="4"){
      $('.outform').find('input').attr('required', true)
      $('.outform').find('select').attr('required', true)
    }
  }
  function adjustsold(event){
    realsold=$('.realsold').val();
    actualsold=$('.actualsold').text()
    console.log('realsold', realsold, 'actualsold', actualsold)
    $.get('/adjustsold',{'realsold':realsold, 'actualsold':actualsold}, (data) => {
      if (data.success){
        // reload the page
        location.reload();
      }
    });
  }
  function getsource(event){
    $.get('/getsource',{'source':$(event.target).val()}, (data) => {
      console.log(data);
      $('.transaction-list').html(data.trs);
      $('.totalfromsource').text(data.total.toFixed(2));
      $('.restfromsource').text(data.rest.toFixed(2));
      
    });
  }
</script>
{% endblock %}